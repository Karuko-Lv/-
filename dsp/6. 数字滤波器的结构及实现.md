
0. 回顾：
	1. 数字滤波器设计目标是给出系统函数 $H (z)$ 
	2. 离散 LTI 系统的差分方程是线性常系数差分方程 $y[k]+\sum_{j=1}^Na_jy[k-j]=\sum_{i=0}^Mb_ix[k-i]$，描述了输入输出之间的约束关系
	3. 系统函数部分分式展开思想
	4. 本讲目的：根据给出的系统函数 $H (z)$ 实现数字滤波器基本结构和有限字长效应
1. IIR 数字滤波器的基本结构
	1. 直接型结构 (Direct Form)
		0. 数字滤波器结构实现当中使用的三个基本单元是单位延时器（$z^{-1}$）、累加器、乘法器
		1. 系统函数：基于差分方程 $y[k]+\sum_{j=1}^Na_jy[k-j]=\sum_{i=0}^Mb_ix[k-i]$ 得到系统函数 $H(z) = \frac{\sum_{i=0}^{M} b_i z^{-i}}{1 + \sum_{j=1}^{N} a_j z^{-j}}$ 依赖于差分方程的系数
		2. 结构框图：  ![[837生物信号处理真题2017——2024.jpeg]]
		3. **直接 I 型 (Direct Form I)**![[6.1 IIR数字滤波器的基本结构 - 1 IIR滤波器直接型结构.jpeg]]
			1. 结构：将系统视为两个子系统的级联：$H_1(z)$（全零点/前馈）和 $H_2(z)$（全极点/反馈）。先实现零点部分，再实现极点部分。
				1. $H_1(z)$：全零点系统（由 $b_i$ 组成，蓝色部分），只涉及输入的延时。
			    2. $H_2(z)$：全极点系统（由 $a_i$ 组成，黑色部分），只涉及反馈的延时。
			2. 特点：需要 $M+N$ 个延时器（非最少）。
			3. 缺点：对有限字长效应敏感。
			4. M 和 N 不一定非要一样
		4. **直接 II 型 (Direct Form II, 典范型)** 【考点】 ![[6.1 IIR数字滤波器的基本结构 - 1 IIR滤波器直接型结构 4 1.jpeg]]
			1. **结构**：交换了直接 I 型中子系统的级联顺序（先反馈后前馈），并利用延时器共用。
				- 线性时不变（LTI）系统具有**交换律**$H(z) = H_1(z) \cdot H_2(z) = H_2(z) \cdot H_1(z)$
				- 交换顺序后，左边的 $H_2$ 和右边的 $H_1$ **都需要对同一个信号 $w[n]$ 进行延时**。
			2. **特点**：仅需 $N$ 个延时器（若 $M \le N$），存储单元最少，被称为**典范型**。
			3. **缺点**：极点对系数量化非常敏感，高阶时容易不稳定。
		5. **转置直接 II 型 (Transposed Direct Form II)** 
			1. **原理**：利用**转置定理**（在信号流图支路反向，输入输出对调，节点变加法器，加法器变节点，系统函数不变）。![[截屏2025-12-06 16.24.26.png]]
				PS：信号流图（Signal Flow Graph）中，**加法器（Adder）表现为有多个箭头指向它的节点（通常是黑色的实心圆点）**。
			2. **特点**：在处理有限字长溢出问题时可能优于普通直接 II 型。🧚‍♀️延时的位置换了
			3. 做题总结🧐：分母项可以画成一个顺时针方向的圈，且由于分母是负反馈所以要变好；且转置是后顺时针
		6. 直接型结构的特点：
			1. 优点：简单直观，给出系统 $H (z)$ 就可以画出相应的流图，分子项是前向通路、分母项对应的是反馈支路
			2. 缺点
				1. 改变分母项的任意一个系数{$a_k$} 都会影响所有的极点
				2. 改变分子项的任意一个系数{$b_k$} 都会影响所有的零点
				3. 对有限字长效应很敏感，容易出现系统不稳定的线性
			==>对于三阶以上的 IIR 滤波器，一般不采用直接型结构，采用级联型、并联型等其他形式的结构 
		![[IMG_F89C871A4761-1.jpeg]]
		分子项对应的是前向通路分母项对应的是反馈通路
	2. 级联型结构 (Cascade Form) 【考点】
		1. 系统函数：将 $H(z)$ （分子分母分解成一阶和二阶实系数因子之积，采用二阶因子表示一阶因子）分解为多个二阶节（Second-Order Sections, SOS）的乘积。$$H(z) = \prod_{i=1}^L\frac{\gamma_{0i}+\gamma_{1i}z^{-1}+\gamma_{2i}z^{-2}}{1+\beta_{1i}z^{-1}+\beta_{2i}z^{-2}}=A \prod_{k=1}^{L} \frac{1 + \beta_{1k} z^{-1} + \beta_{2k} z^{-2}}{1 + \alpha_{1k} z^{-1} + \alpha_{2k} z^{-2}}$$
			- 首先要求是实系数的因子，如果只用一阶表示可能会有复数的因子在里面；用二阶因子表现一阶因子是因为实现过程当中往往会给出二阶因子模版，一阶因子只需要 $\beta_{2 k}$ 和 $\alpha_{2k}$ 等于 0 即可
			- 后者将分子每一个二阶因子第一项归一化，将所有系数归到A，介绍乘法器的个数
			- 二阶基本节：$\frac{1+\alpha_{1i}z^{-1}+\alpha_{2i}z^{-2}}{1+\beta_{1i}z^{-1}+\beta_{2i}z^{-2}}$，可以表示一阶因子的形式
			**实现**：每个二阶节用直接 II 型实现，然后级联 
		2. 基于直接 II 型的级联型结构![[IMG_04243F30835C-1.jpeg]]
		3. 基于转置直接 II 型的级联型结构 ![[6.1 IIR数字滤波器的基本结构 - 2 IIR滤波器级联和并联型结构 2.jpeg]]
		4. 级联型结构的特点（**应用**：工程中最常用的 IIR 结构）
			1. 每一个基本节系数的变化只影响该子系统的零极点（每一个基本节代表一个子系统）
			2. 对系数变化的敏感度小，（每个二阶基本节的系数只影响自己的二阶基本节，不影响其他节），受有限字长的影响比直接型低🐤**对系数变化的敏感度远低于直接型**（极点位置误差小）
		![[截屏2025-12-06 18.23.17.png]]
		 直接型结构是并联和级联型的基础，因为实现一阶二阶实系数因子用的是直接型结构
	3. 并联型结构 (Parallel Form)
		1. 系统函数：将 $H(z)$ 展开为部分分式之和，且采用二阶基本节表示一阶子系统：$$H(z)=\gamma_0+\sum_{k=1}^L\frac{\gamma_{0k}+\gamma_{1k}z^{-1}}{1+\beta_{1k}z^{-1}+\beta_{2k}z^{-2}}$$**实现**：各二阶节用直接 II 型实现，并联运行，最后相加。
		2. 基于直接 II 型的并联型结构 ![[IMG_A28C6D0642E7-1.jpeg]]
		3. 基于转置直接 II 型的并联型结构 ![[6.1 IIR数字滤波器的基本结构 - 2 IIR滤波器级联和并联型结构 3.jpeg]]
		4. **优点**：
			1. 运算速度快（可并行处理），处理延时短。 【考点】
			2. **误差隔离**：一个子系统的误差不会传播到其他子系统，即各基本节的误差互不影响
			3. 每一个基本节系数变换只影响该子系统（二阶基本集）的零极点，极点调整独立，但**不能**像级联型那样直接控制零点（因为子系统零点 $\neq$ 总系统零点）。
		![[截屏2025-12-06 18.20.54.png]]
	【总结】同一个 $H (z)$ 可通过不同的结构来实现
2. FIR 数字滤波器的基本结构
	1. 直接型(卷积型)结构
		1. 系统函数：FIR 滤波器无反馈（非递归），总是稳定的。$$H(z) = \sum_{n=0}^{M} h[n] z^{-n}$$ 比较简单，只有分子项
		2. 结构：抽头延迟线 ![[6.1 IIR数字滤波器的基本结构 - 2 IIR滤波器级联和并联型结构 4.jpeg]]
		3. **资源**：$M$ 个延迟器，$M+1$ 个乘法器。
	2. 线性相位 FIR 结构 【考点】
		1. 系统函数：$H (z) = \sum_{n=0}^{M} h[n] z^{-n}$，当满足 $h[k] = \pm h[M-k]$ 时，FIR 具有线性相位（M 是阶数）![[IMG_7633006330C7-1.jpeg]] 可以少掉一部分乘法器🧚‍♀️这个图有点绕，但是成本低；【画法】先画出输入和输出线，再画出延迟期，后面就是连线，很简单的别怕，试着做一下就好
				- M 的奇偶可以根据四型确定，具体的值要根据过渡带宽和最小衰耗确定[[🌟FIR滤波器M的大小确定]]
		2. 画法总结：![[IMG_FD9952825587-1.jpeg]]
		3. **优化**：利用系数对称性，可先将对称的输入信号相加/减，再与系数相乘。
		4. **收益**：**乘法器数量减少一半**（约为 $M/2$）。
		5. **四种类型**：
			- **I 型**：$M$ 为偶数（长度为奇数），对称（偶对称）。
			- **II 型**：$M$ 为奇数（长度为偶数），对称（偶对称）。（必有 $H(e^{j\pi})=0$，不能做高通）
			- **III 型**：$M$ 为偶数，反对称（奇对称）。（必有 $H(e^{j0})=H(e^{j\pi})=0$，只能做带通）。
			- **IV 型**：$M$ 为奇数，反对称（奇对称）。（必有 $H(e^{j0})=0$，不能做低通）。
	3. 级联型结构
		1. 系统函数：将 $H(z)$ 分解为若干个实系数一阶或者二阶因子的乘积。$$H(z)=h[0]\prod_{k=1}^L(1+\beta_{1,k}z^{-1}+\beta_{2,k}z^{-2})$$ 原理和 IIR 数字滤波器级联一样，分别用直接型结构实现每一个实系数的一阶或者二阶因子，由于每一个二阶节中也是一个小的 FIR 滤波器，所以没有反馈项只有前向通路。级联型结构可以分别控制每一个子系统的零点
		2. **优点**：便于精确控制滤波器的传输零点。
---
## 1. 概述

数字滤波器结构实现当中使用的三个基本单元是单位延时器（$z^{-1}$）、累加器、乘法器主要由加法器、乘法器和单位延时器（$z^{-1}$）三个基本元件组成。同一系统函数 $H(z)$ 可以有多种不同的结构实现。

- **核心理念**：虽然理论上不同结构是等效的，但在**有限字长**（Finite Word Length）限制下，不同结构的误差、稳定性、运算速度和经济性差异巨大。
     
## 4. 有限字长效应 (Finite Word Length Effects)

这是本章的核心难点，主要包含三种误差来源。

### 4.1 二进制表示与量化误差

- **定点数表示**：通常使用**补码 (2's complement)**。
    
- **量化方式**：
    
    1. **截尾 (Truncation)**：直接丢弃低位。
        
        - 补码截尾误差 $e_T$ 范围：$-q < e_T \le 0$。
            
        - 均值 $m_e = -q/2$（有偏）。 【考点】
            
    2. **舍入 (Rounding)**：看低位决定进位。
        
        - 误差 $e_R$ 范围：$-q/2 < e_R \le q/2$。
            
        - 均值 $m_e = 0$（无偏）。
            
        - 方差（噪声功率）：$\sigma_e^2 = \frac{q^2}{12}$ （其中 $q = 2^{-b}$）。 【核心公式/考点】
            

### 4.2 输入信号量化误差 (A/D 转换噪声)

模拟信号数字化引入的误差，建模为加性白噪声。

- **模型假设**：误差 $e[k]$ 是互不相关的白噪声，且与信号 $x[k]$ 不相关。
    
- **输出噪声方差**：输入噪声通过滤波器 $h[k]$ 后的输出方差。
    
    $$\sigma_v^2 = \sigma_e^2 \sum_{k=0}^{\infty} h^2[k] = \sigma_e^2 \frac{1}{2\pi} \int_{-\pi}^{\pi} |H(e^{j\omega})|^2 d\omega$$
    
    _(利用了 Parseval 定理)_ 【考点】
    
- **信噪比 (SNR)**：字长每增加 1 位，SNR 增加约 **6dB**。
    
    $$SNR \approx 6.02b + 10.79 + 10\lg(\sigma_x^2)$$

### 4.3 滤波器系数量化误差

因寄存器字长有限，设计的系数 $b_k, a_k$ 被量化，导致 $H(z)$ 改变。

- **影响**：
    
    1. 频率响应偏离（实际幅频特性不达标）。
        
    2. **极点漂移**：IIR 极点可能移出单位圆，导致**系统不稳定**。FIR 只有零点，只会变频响，不会不稳定。
        
- **极点灵敏度**：
    
    - 直接型结构的极点灵敏度较高，尤其是极点密集或靠近单位圆时。
        
    - **结论**：高阶 IIR 应采用**级联型**或**并联型**，避免使用高阶直接型。 【考点】
        

### 4.4 乘积运算量化误差 (Round-off Noise)

定点乘法后字长变长，需再次量化（截尾或舍入），相当于在每个乘法器后注入噪声源 $e_i[k]$。

- **FIR 分析**：无反馈，所有噪声源直接叠加到输出。
    
    $$\sigma_o^2 = (M+1)\frac{q^2}{12}$$
    
    _(假设所有乘法器都在输出端累加前量化)_
    
- **IIR 分析**：
    
    - **直接型**：噪声源需经过系统的反馈部分传输到输出。
        
    - **级联型**：前一级的噪声会经过后续所有级传输。
        
    - **并联型**：各路噪声独立传输。
        
    - **结论**：通常并联型输出噪声最小，直接型最大。 【小众点/考点】
        

### 4.5 极限环振荡 (Limit Cycles)

在 IIR 系统中，由于反馈环路中的非线性量化操作（特别是截尾），当输入为 0 或常数时，输出可能出现持续的等幅振荡。

1. **零输入极限环**：输入为 0，输出在小范围内振荡（死区 Dead-band）。
    
2. **溢出振荡**：加法溢出导致的大幅度振荡（最危险）。
    

- **解决**：增加字长、使用饱和算术逻辑、使用级联/并联结构。
    

## 5. MATLAB 实现与辅助设计 (6.4 & 习题)

- **基本滤波**：
    
    ```
    y = filter(b, a, x); % b为分子系数，a为分母系数
    ```
    
- **结构转换**：
    
    1. **直接型** $\to$ **级联型 (SOS)**：
        
        ```
        [sos, g] = tf2sos(b, a); 
        % sos 矩阵每行是一个二阶节 [b0 b1 b2 1 a1 a2]
        ```
        
    2. **直接型** $\to$ **并联型 (Residue)**：
        
        ```
        [r, p, k] = residuez(b, a);
        % r: 留数, p: 极点, k: 直通项
        ```
        
    3. **零极点** $\to$ **级联型**：
        
        ```
        sos = zp2sos(z, p, k);
        ```